{"version":3,"file":"Autocomplete.stories-ef6e291f.js","sources":["../../../../packages/antwerp-ui/react-components/src/lib/molecules/autocomplete/Autocomplete.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport { TextField } from '../../atoms/input';\nimport { FunctionalList, ListItem } from '../../atoms/list';\nimport { Flyout } from '../flyout';\nimport { AutocompleteProps } from './Autocomplete.types';\nimport './Autocomplete.css';\n\nexport function Autocomplete({\n  id,\n  label,\n  items,\n  name,\n  inputValue,\n  value,\n  onInputChange,\n  onChange,\n  noResultsText,\n  qa\n}: AutocompleteProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [results, setResults] = useState(items);\n  const [input, setInput] = useState(inputValue || '');\n  const [selected, setSelected] = useState(value || '');\n  const [cursor, setCursor] = useState(-1);\n\n  const fieldValue = inputValue || inputValue === '' ? inputValue : input;\n  const selectedValue = value || value === '' ? value : selected;\n\n  const flyoutRef = React.useRef(null);\n\n  useEffect(() => {\n    if (value) {\n      selectValue(value, true);\n    }\n  }, [value]);\n\n  useEffect(() => {\n    setResults(\n      (items || []).filter((i) => (fieldValue ? i.label?.toLowerCase().includes(fieldValue.toLowerCase()) : true))\n    );\n  }, [fieldValue]);\n\n  useEffect(() => {\n    if (flyoutRef.current) {\n      const current = flyoutRef.current as HTMLDivElement;\n      const highlighted = current.querySelector(`.a-list__item:nth-child(${cursor + 1})`);\n      highlighted?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n    }\n  }, [cursor]);\n\n  const handleStateChange = (state: boolean) => {\n    setIsOpen(state);\n  };\n\n  const closeFlyout = () => {\n    setIsOpen(false);\n    setCursor(-1);\n  };\n\n  const handleInput = (val: string) => {\n    setInput(val);\n    setIsOpen(true);\n    if (selectedValue && !val) {\n      setSelected('');\n      onChange && onChange('', name);\n    }\n    onInputChange && onInputChange(val, name);\n  };\n\n  const selectValue = (val: string, silence = false) => {\n    if (value !== '' && (!value || value === val)) {\n      const actualValue = items?.find((i) => i.value === val);\n      handleInput(actualValue?.label || '');\n      setSelected(actualValue?.value || '');\n      closeFlyout();\n    }\n    !silence && onChange && onChange(val, name);\n  };\n\n  const setValueBack = () => {\n    const actualValue = items?.find((i) => i.value === selectedValue);\n    if (actualValue && fieldValue?.length && actualValue.label !== fieldValue) {\n      handleInput(actualValue.label);\n    }\n    closeFlyout();\n  };\n\n  const onEnter = () => {\n    const highlighted = results && results[cursor];\n    if (highlighted) {\n      selectValue(highlighted.value);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const totalResults = results?.length || 0;\n    switch (e.key) {\n      case 'ArrowDown':\n        setCursor(cursor === -1 ? 0 : (cursor + 1) % totalResults);\n        return setIsOpen(true);\n      case 'ArrowUp':\n        setCursor(cursor === -1 ? totalResults - 1 : cursor - 1 < 0 ? totalResults - 1 : cursor - 1);\n        return setIsOpen(true);\n      case 'Enter':\n        return onEnter();\n      case 'Escape':\n        return closeFlyout();\n      default:\n        break;\n    }\n  };\n\n  return (\n    <Flyout\n      scrollable\n      hasPadding={false}\n      qa={qa}\n      trigger={\n        <TextField\n          id={id}\n          name={name}\n          label={label}\n          onBlur={setValueBack}\n          value={fieldValue}\n          onChange={(e) => handleInput(e.target.value)}\n          role=\"combobox\"\n          aria-autocomplete=\"list\"\n          aria-haspopup=\"true\"\n          aria-expanded={isOpen}\n          onKeyDown={handleKeyDown}\n        />\n      }\n      ref={flyoutRef}\n      open={isOpen}\n      onStateChange={handleStateChange}\n    >\n      {results && results.length ? (\n        <FunctionalList lined onItemClick={selectValue}>\n          {results.map((r, i) => (\n            <ListItem\n              tabIndex={-1}\n              highlighted={i === cursor}\n              onMouseDown={(e) => e.preventDefault()}\n              active={r.value === selectedValue}\n              name={r.value}\n              link={{ href: '' }}\n              key={r.value}\n            >\n              {r.label}\n            </ListItem>\n          ))}\n        </FunctionalList>\n      ) : (\n        <FunctionalList lined>\n          <ListItem>\n            <small>{noResultsText}</small>\n          </ListItem>\n        </FunctionalList>\n      )}\n    </Flyout>\n  );\n}\n\nAutocomplete.defaultProps = {\n  id: 'aui-autocomplete',\n  noResultsText: 'Geen resultaten'\n};\n\nexport default Autocomplete;\n"],"names":["Autocomplete","id","label","items","name","inputValue","value","onInputChange","onChange","noResultsText","qa","isOpen","setIsOpen","useState","results","setResults","input","setInput","selected","setSelected","cursor","setCursor","fieldValue","selectedValue","flyoutRef","React","useRef","useEffect","selectValue","filter","i","toLowerCase","includes","current","highlighted","querySelector","scrollIntoView","block","inline","handleStateChange","__name","state","closeFlyout","handleInput","val","silence","actualValue","find","setValueBack","length","onEnter","Flyout","TextField","e","target","totalResults","key","handleKeyDown","FunctionalList","map","r","ListItem","preventDefault","href","_jsx","defaultProps"],"mappings":"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"}